paths:
  /backends/wazo/sources:
    get:
      operationId: list_wazo_source
      summary: Get all `wazo` source configurations
      description: '**Required ACL:** `dird.backends.wazo.sources.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/Limit'
        - $ref: '#/parameters/Offset'
      responses:
        '200':
          description: A list of configured `wazo` sources
          schema:
            $ref: '#/definitions/WazoSourceItems'
    post:
      operationId: create_wazo_source
      summary: Configure a source for the `wazo` backend
      description: '**Required ACL:** `dird.backends.wazo.sources.create`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/WazoSource'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/WazoSource'
        '400':
          $ref: '#/responses/CreateError'
  /backends/wazo/sources/{source_uuid}:
    get:
      operationId: get_a_wazo_source
      summary: Get a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '200':
          description: The `wazo` source
          schema:
            $ref: '#/definitions/WazoSource'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_wazo_source
      summary: Update a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
        - name: body
          in: body
          description: The source configuration body
          required: true
          schema:
            $ref: '#/definitions/WazoSource'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
    delete:
      operationId: delete_wazo_source
      summary: Delete a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
definitions:
  WazoSource:
    title: WazoSource
    allOf:
      - properties:
          uuid:
            type: string
            description: The source's UUID
            readOnly: true
          name:
            type: string
            description: The source's name
          searched_columns:
            type: array
            items:
              type: string
            description: A list of columns which should be searched when doing a look up
          first_matched_columns:
            type: array
            items:
              type: string
            description: A list of columns which should be searched when doing a reverse look up
          format_columns:
            type: object
            description: A mapping of new fields and a python format string to generate the new columns value
          auth:
            $ref: '#/definitions/WazoAuthConfig'
          confd:
            $ref: '#/definitions/ConfdConfig'
      - required:
        - name
        - auth
        - confd
  WazoSourceItems:
    title: WazoSourceItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/WazoSource'
            readOnly: true
          total:
            type: integer
            description: The number of configured `wazo` sources
            readOnly: true
          filtered:
            type: integer
            description: The number of configured `wazo` sources matching the searched terms
            readOnly: true
      - required:
          - items
          - total
          - filtered
  ConfdConfig:
    title: Confd
    allOf:
      - properties:
          host:
            type: string
            default: localhost
          port:
            type: integer
            default: 9486
          https:
            type: boolean
            default: true
          timeout:
            type: number
            default: 4.0
            description: The HTTP queries timeout
          verify_certificate:
            type: string
            description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
            default: /usr/share/xivo-certs/server.crt
          version:
            type: string
            default: "1.1"
  WazoAuthConfig:
    title: Auth
    allOf:
      - properties:
          host:
            type: string
            default: localhost
          port:
            type: integer
            default: 9497
          key_file:
            type: string
            description: The path the the file containing the credentials
            default: /var/lib/wazo-auth-keys/wazo-dird-wazo-backend-key.yml
          username:
            type: string
            description: The username to use when not using a key_file
          password:
            type: string
            description: The password to use when not using a key_file
          verify_certificate:
            type: string
            description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
            default: /usr/share/xivo-certs/server.crt
          timeout:
            type: number
          version:
            type: string
            default: "0.1"
