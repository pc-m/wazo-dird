paths:
  /config:
    get:
      summary: Returns the current service configuration
      description: '**Required ACL:** `dird.config.read`'
      operationId: configuration_get
      tags:
        - configuration
      produces:
        - application/json
      responses:
        '200':
          description: A JSON representation of the current configuration.
  /displays:
    get:
      operationId: list_display
      summary: List displays
      description: '**Required ACL:** `dird.displays.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of configured displays
          schema:
            $ref: '#/definitions/DisplayItems'
    post:
      summary: Create a new display configuration
      description: '**Required ACL:** `dird.displays.create`'
      operationId: create_display
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/Display'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/Display'
        '400':
          $ref: '#/responses/CreateError'
  /displays/{display_uuid}:
    get:
      operationId: get_display
      summary: Get display
      description: '**Required ACL:** `dird.displays.{display_uuid}.read`'
      tags:
        - configuration
      parameters:
      - $ref: '#/parameters/tenantuuid'
      - $ref: '#/parameters/displayuuid'
      responses:
        '200':
          description: Display
          schema:
            $ref: '#/definitions/Display'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_display
      summary: Update display
      description: '**Required ACL:** `dird.displays.{display_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/displayuuid'
        - name: body
          in: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/Display'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
    delete:
      operationId: delete_display
      summary: Delete display
      description: '**Required ACL:** `dird.displays.{display_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/displayuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
  /sources:
    get:
      operationId: list_source
      summary: List all configured sources
      description: '**Required ACL:** `dird.sources.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of configured sources
          schema:
            $ref: '#/definitions/SourceItems'
  /backends:
    get:
      operationId: list_backend
      summary: List all loaded backends
      tags:
        - configuration
      description: '**Required ACL:** `dird.backends.read`'
      parameters:
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of all active backends
          schema:
            $ref: '#/definitions/BackendItems'
  /backends/wazo/sources:
    get:
      operationId: list_wazo_source
      summary: Get all `wazo` source configurations
      description: '**Required ACL:** `dird.backends.wazo.sources.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of configured `wazo` sources
          schema:
            $ref: '#/definitions/WazoSourceItems'
    post:
      operationId: create_wazo_source
      summary: Configure a source for the `wazo` backend
      description: '**Required ACL:** `dird.backends.wazo.sources.create`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: The display configuration body
          required: true
          schema:
            $ref: '#/definitions/WazoSource'
      responses:
        '201':
          description: The created display
          schema:
            $ref: '#/definitions/WazoSource'
        '400':
          $ref: '#/responses/CreateError'
  /backends/wazo/sources/{source_uuid}:
    get:
      operationId: get_a_wazo_source
      summary: Get a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '200':
          description: The `wazo` source
          schema:
            $ref: '#/definitions/WazoSource'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_wazo_source
      summary: Update a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
        - name: body
          in: body
          description: The source configuration body
          required: true
          schema:
            $ref: '#/definitions/WazoSource'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
    delete:
      operationId: delete_wazo_source
      summary: Delete a `wazo` source configuration
      description: '**Required ACL:** `dird.backends.wazo.sources.{source_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/sourceuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
  /services:
    get:
      operationId: list_services
      summary: List all loaded services
      description: '**Required ACL:** `dird.services.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of configured services
          schema:
            $ref: '#/definitions/ServiceItems'
  /profiles:
    post:
      operationId: create_profile
      summary: Create a new configuration profile
      description: '**Required ACL:** `dird.profiles.create`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - name: body
          in: body
          description: The profile configuration
          schema:
            $ref: '#/definitions/Profile'
      responses:
        '201':
          description: The created profile
          schema:
            $ref: '#/definitions/Profile'
        '400':
          $ref: '#/responses/CreateError'
    get:
      operationId: list_profile
      summary: List all configured profiles
      description: '**Required ACL:** `dird.profiles.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/recurse'
        - $ref: '#/parameters/order'
        - $ref: '#/parameters/direction'
        - $ref: '#/parameters/limit'
        - $ref: '#/parameters/offset'
      responses:
        '200':
          description: A list of configured profiles
          schema:
            $ref: '#/definitions/ProfileItems'
  /profiles/{profile_uuid}:
    get:
      operationId: get_profile
      summary: Get a profile configuration
      description: '**Required ACL:** `dird.profiles.{profile_uuid}.read`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/profileuuid'
      responses:
        '200':
          description: Profile
          schema:
            $ref: '#/definitions/Profile'
        '404':
          $ref: '#/responses/NotFoundError'
    put:
      operationId: update_profile
      summary: Update a profile configuration
      description: '**Required ACL:** `dird.profiles.{profile_uuid}.update`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/profileuuid'
        - name: body
          in: body
          description: The profile configuration body
          required: true
          schema:
            $ref: '#/definitions/Profile'
      responses:
        '204':
          $ref: '#/responses/ResourceUpdated'
        '400':
          $ref: '#/responses/UpdateError'
        '404':
          $ref: '#/responses/NotFoundError'
    delete:
      operationId: delete_profile
      summary: Delete a profile configuration
      description: '**Required ACL:** `dird.profiles.{profile_uuid}.delete`'
      tags:
        - configuration
      parameters:
        - $ref: '#/parameters/tenantuuid'
        - $ref: '#/parameters/profileuuid'
      responses:
        '204':
          $ref: '#/responses/ResourceDeleted'
        '404':
          $ref: '#/responses/NotFoundError'
parameters:
  backendname:
    required: true
    type: string
    name: backend_name
    in: path
    description: the backend's name
  displayuuid:
    required: true
    type: string
    name: display_uuid
    in: path
    description: the display's UUID
  profileuuid:
    required: true
    type: string
    name: profile_uuid
    in: path
    description: the profile's UUID
  recurse:
    name: recurse
    in: query
    type: boolean
    description: Should the query include sub-tenants
    default: false
    required: false
  tenantuuid:
    name: Wazo-Tenant
    type: string
    in: header
    description: "The tenant's UUID, defining the ownership of a given resource."
    required: false
  search:
    required: false
    name: search
    in: query
    type: string
    description: Search term for filtering a list of items. Only items with a field
      containing the search term will be returned.
  sourceuuid:
    name: source_uuid
    type: string
    in: path
    description: "The source's UUID"
    required: true
  limit:
    name: limit
    in: query
    type: integer
    description: The limit defines the number of individual objects that are returned
    required: false
  offset:
    name: offset
    in: query
    type: integer
    description: The offset defines the offsets the start by the number specified
    default: 0
    required: false
responses:
  CreateError:
    description: An error occurred when creating the resource
    schema:
      $ref: '#/definitions/APIError'
  NotFoundError:
    description: The resource requested was not found on the server
    schema:
      $ref: '#/definitions/Error'
  ResourceUpdated:
    description: Resource was updated successfully
  ResourceDeleted:
    description: Resource was deleted successfully
  UpdateError:
    description: An error occurred when updating the resource
    schema:
      $ref: '#/definitions/APIError'
definitions:
  APIError:
    type: object
    properties:
      timestamp:
        type: number
      message:
        type: string
      resource:
        type: string
      details:
        type: object
  Backend:
    title: Backend
    allOf:
      - properties:
          name:
            type: string
            readOnly: true
      - required:
          - name
  BackendItems:
    title: BackendItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/Backend'
            readOnly: true
          total:
            type: integer
            description: The number of backends
            readOnly: true
          filtered:
            type: integer
            description: The number of backends matching the search filters
            readOnly: true
      - required:
          - items
          - total
          - filtered
  Display:
    title: Display
    allOf:
      - properties:
          uuid:
            type: string
            description: The display's UUID
            readOnly: true
          name:
            type: string
            description: The name of the display
          fields:
            type: array
            items:
              $ref: '#/definitions/DisplayField'
            default: []
      - required:
          - name
  DisplayIdentifier:
    title: DisplayUUID
    allOf:
      - properties:
          uuid:
            type: string
            description: "The display's UUID"
            readOnly: true
      - required:
          - uuid
  DisplayField:
    title: Field
    allOf:
      - properties:
          name:
            type: string
            description: The name of the field to display in this column
          title:
            type: string
            description: A human readable name for this column
          type:
            type: string
            description: The type of this column
          default:
            type: string
            description: A default value if theres no result in this column
          number_display:
            type: string
            description: A format string that overrides the default display. for number columns only.
      - required:
          - name
  DisplayItems:
    title: DisplayItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/Display'
            readOnly: true
          total:
            type: integer
            description: The number of configured displays
            readOnly: true
          filtered:
            type: integer
            description: The number of configured displays matching the searched terms
            readOnly: true
      - required:
          - items
          - total
          - filtered
  Profile:
    title: Profile
    allOf:
      - properties:
          uuid:
            type: string
            readOnly: true
          name:
            type: string
            description: The name of the profile
          display:
            $ref: '#/definitions/DisplayIdentifier'
          services:
            type: array
            items:
              $ref: '#/definitions/ServiceConfiguration'
      - required:
          - name
  ProfileItems:
    title: ProfileItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/Profile'
            readOnly: true
          total:
            type: integer
            description: The number of configured profiles
            readOnly: true
          filtered:
            type: integer
            description: The number of configured profiles matching the searched terms
            readOnly: true
      - required:
          - items
          - total
          - fitered
  Service:
    title: Service
    allOf:
      - properties:
          name:
            type: string
            readOnly: true
      - required:
          - name
  ServiceConfiguration:
    title: Service
    allOf:
      - properties:
          name:
            type: string
            description: The service name
          sources:
            type: array
            items:
              $ref: '#/definitions/SourceIdentifier'
            default: []
          options:
            type: object
            description: Service specific configuration options
      - required:
          - name
  ServiceItems:
    title: ServiceItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/Service'
            readOnly: true
          total:
            type: integer
            description: The number of services
            readOnly: true
          filtered:
            type: integer
            description: The number of services matching the search filters
            readOnly: true
      - required:
          - items
          - total
          - filtered
  Source:
    title: Source
    allOf:
      - properties:
          uuid:
            type: string
            description: The UUID of the source
            readOnly: true
          backend:
            type: string
            description: The backend of this source
            readOnly: true
          name:
            type: string
            description: The name of the source
            readOnly: true
      - required:
          - uuid
          - backend
          - name
  SourceIdentifier:
    title: SourceUUID
    allOf:
      - properties:
          uuid:
            type: string
            description: The source's UUID
            readOnly: true
      - required:
        - uuid
  SourceItems:
    title: SourceItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/Source'
            readOnly: true
          total:
            type: integer
            description: The number of sources
            readOnly: true
          filtered:
            type: integer
            description: The number of sources matching the search filters
            readOnly: true
      - required:
          - items
          - total
          - filtered
  WazoSource:
    title: WazoSource
    allOf:
      - properties:
          uuid:
            type: string
            description: The source's UUID
            readOnly: true
          name:
            type: string
            description: The source's name
          searched_columns:
            type: array
            items:
              type: string
            description: A list of columns which should be searched when doing a look up
          first_matched_columns:
            type: array
            items:
              type: string
            description: A list of columns which should be searched when doing a reverse look up
          format_columns:
            type: object
            description: A mapping of new fields and a python format string to generate the new columns value
          auth:
            $ref: '#/definitions/WazoAuthConfig'
          confd:
            $ref: '#/definitions/WazoConfdConfig'
      - required:
        - name
        - auth
        - confd
  WazoSourceItems:
    title: WazoSourceItems
    allOf:
      - properties:
          items:
            type: array
            items:
              $ref: '#/definitions/WazoSource'
            readOnly: true
          total:
            type: integer
            description: The number of configured `wazo` sources
            readOnly: true
          filtered:
            type: integer
            description: The number of configured `wazo` sources matching the searched terms
            readOnly: true
      - required:
          - items
          - total
          - filtered
  WazoConfdConfig:
    title: Confd
    allOf:
      - properties:
          host:
            type: string
            default: localhost
          port:
            type: integer
            default: 9486
          https:
            type: boolean
            default: true
          timeout:
            type: number
            default: 4.0
            description: The HTTP queries timeout
          verify_certificate:
            type: string
            description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
            default: /usr/share/xivo-certs/server.crt
          version:
            type: string
            default: 1.1
  WazoAuthConfig:
    title: Auth
    allOf:
      - properties:
          host:
            type: string
            default: localhost
          port:
            type: integer
            default: 9497
          key_file:
            type: string
            description: The path the the file containing the credentials
            default: /var/lib/wazo-auth-keys/wazo-dird-wazo-backend-key.yml
          username:
            type: string
            description: The username to use when not using a key_file
          password:
            type: string
            description: The password to use when not using a key_file
          verify_certificate:
            type: string
            description: If the HTTPs certificates should be verified and the path of the certificate if a custom certificate is used.
            default: /usr/share/xivo-certs/server.crt
